<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Immersive AI Chatbot</title>
  <style>
    /* =============================================
       Global Styles & Resets
       ============================================= */
    body {
      margin: 0;
      overflow: hidden; /* Prevent scrollbars, assuming full viewport canvas */
      background-color: #000; /* Dark background for immersive feel */
      font-family: Arial, sans-serif; /* Default font */
      color: #fff; /* Default text color */
    }

    /* =============================================
       Informational Overlay
       ============================================= */
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 100; /* Ensure it's on top of other elements */
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); /* Subtle text glow */
    }

    /* =============================================
       Chat Container Styles
       ============================================= */
    #chat-container {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 320px; /* Fixed width for chat container */
      background-color: rgba(0, 0, 0, 0.85); /* Dark, semi-transparent background */
      padding: 15px;
      border-radius: 8px; /* Rounded corners for chat container */
      backdrop-filter: blur(5px); /* Frosted glass effect */
      border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle border */
    }

    /* Chat Messages Area */
    #chat-messages {
      max-height: 400px; /* Limit message area height */
      overflow-y: auto; /* Enable vertical scrolling within message area */
      margin-bottom: 15px; /* Spacing below messages */
      padding-right: 10px; /* Space for scrollbar */
    }

    /* Individual Chat Message */
    .chat-message {
      margin: 10px 0; /* Spacing between messages */
      padding: 8px 12px;
      border-radius: 6px; /* Rounded corners for messages */
      background-color: rgba(255, 255, 255, 0.05); /* Very subtle background */
      animation: fadeIn 0.3s ease-in; /* Fade-in animation for new messages */
      word-wrap: break-word; /* Prevent long words from breaking layout */
    }

    /* System Messages (AI responses, errors, planet info) */
    .system-message {
      color: #00ff88; /* Distinct color for system messages */
      background-color: transparent; /* No background */
      border: 1px solid rgba(0, 255, 136, 0.2); /* Subtle border */
    }

    /* Preformatted Text (Code blocks, technical info) */
    pre {
      background-color: #1a1a1a; /* Darker background for code blocks */
      color: #00ff88; /* Highlight color for code */
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto; /* Enable horizontal scrolling for long code lines */
      font-family: 'Courier New', monospace; /* Monospace font for code */
      margin: 8px 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Loading Indicator */
    #loading {
      display: none; /* Hidden by default */
      color: #ffd700; /* Gold color for loading text */
      padding: 8px;
      text-align: center;
    }

    /* =============================================
       Input & Button Styles
       ============================================= */
    input, button {
      width: 100%; /* Full width within container */
      margin: 8px 0; /* Spacing above and below inputs/button */
      padding: 10px;
      border: none;
      border-radius: 4px; /* Slightly rounded corners for inputs/button */
      font-size: 14px;
      transition: all 0.3s ease; /* Smooth transition for hover/focus effects */
      box-sizing: border-box; /* Ensure padding is included in width */
    }

    /* Input Fields */
    input {
      background-color: rgba(255, 255, 255, 0.1); /* Subtle background for input */
      color: #fff;
    }

    input:focus {
      outline: 2px solid #007bff; /* Blue outline on focus */
    }

    /* Button */
    button {
      background-color: #007bff; /* Blue button background */
      color: white;
      font-weight: bold; /* Bold button text */
      cursor: pointer; /* Pointer cursor on hover */
    }

    button:hover {
      background-color: #0056b3; /* Darker blue on hover */
      transform: translateY(-1px); /* Slight lift on hover */
    }

    /* =============================================
       Animations
       ============================================= */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="separator" style="clear: both; text-align: center;">
    <a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEit4ny4cCANRL-X3YgAkgEfjHEbILWN9Lj46jo1JGBJFPlaDgzBisg8UFhPPrGQ0aWdwd7gKf-g4kENiELCF6O3FTvu5gqfkHUxf470myjSIEY54SogGNRcECz_nUtOwbgRO3Ysf-lExf3FXW69yeLtYUxbraPc662At1mG-JZUoaSInQf1KhNhjjSGiPWi/s1024/1000074327.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
      <img alt="RA" border="0" data-original-height="1024" data-original-width="1024" height="640" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEit4ny4cCANRL-X3YgAkgEfjHEbILWN9Lj46jo1JGBJFPlaDgzBisg8UFhPPrGQ0aWdwd7gKf-g4kENiELCF6O3FTvu5gqfkHUxf470myjSIEY54SogGNRcECz_nUtOwbgRO3Ysf-lExf3FXW69yeLtYUxbraPc662At1mG-JZUoaSInQf1KhNhjjSGiPWi/w640-h640/1000074327.jpg" width="640" />
    </a>
  </div>
  <br>

  <div id="info">Click planets for info | Scroll to zoom | Drag to rotate</div>

  <div id="chat-container">
    <div id="chat-messages"></div>
    <input id="api-key" placeholder="🔑  API Key (No longer used)" type="password" disabled />
    <input id="user-input" placeholder="🚀 Ask about space..." type="text" />
    <button onclick="sendChat()">Send Message</button>
    <div id="loading">🔭 Scanning the cosmos...</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

  <script>
    // =============================================
    //  Constants and Variables
    // =============================================
    const PLANET_ORBIT_SPEED = 0.005; // Animation speed for planet orbits
    const PLANET_DATA = [       // Data for each planet
      { name: 'Mercury', color: 0x808080, size: 0.4, distance: 8 },
      { name: 'Venus',   color: 0xffd700, size: 0.9, distance: 11 },
      { name: 'Earth',   color: 0x0000ff, size: 1,   distance: 15 },
      { name: 'Mars',    color: 0xff0000, size: 0.5, distance: 20 },
      { name: 'Jupiter', color: 0xffa500, size: 2.5, distance: 28 },
      { name: 'Saturn',  color: 0xffd700, size: 2,   distance: 35 },
      { name: 'Uranus',  color: 0x00ffff, size: 1.5, distance: 40 },
      { name: 'Neptune', color: 0x0000ff, size: 1.5, distance: 45 }
    ];

    let scene, camera, renderer, controls; // Three.js scene elements
    const planets = [];                      // Array to hold planet objects

    // **========  Unity CCD IDs (UPDATED) ========**
    const projectId = "8731fc3e-5836-463a-b4e9-be7d8ce5082d";
    const environmentId = "9d47ebbe-1eab-4823-92a2-1ea1a92bb0e9";
    const bucketId_2 = "6b6cc494-7a21-4c57-b0f7-4bc6f1c4490d"; // Bucket ID from inner URL (path)
    const baseURL = `https://${projectId}.client-api.unity3dusercontent.com/client_api/v1`; // Updated baseURL with projectId

    // =============================================
    //  Initialization Functions
    // =============================================

    function initSolarSystem() {
      setupThreeJS();
      createSun();
      createPlanets();
      setupCameraAndControls();
      addPlanetClickHandler(); // Enable planet click interactions
      animate();              // Start the animation loop
    }

    function setupThreeJS() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const light = new THREE.PointLight(0xffffff, 1.5); // Soft white light
      scene.add(light);
    }

    function createSun() {
      const sunGeometry = new THREE.SphereGeometry(5, 32, 32);
      const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 }); // Yellow sun
      const sun = new THREE.Mesh(sunGeometry, sunMaterial);
      scene.add(sun);
    }

    function createPlanets() {
      PLANET_DATA.forEach(data => {
        const planetGeometry = new THREE.SphereGeometry(data.size, 32, 32);
        const planetMaterial = new THREE.MeshPhongMaterial({ color: data.color });
        const planet = new THREE.Mesh(planetGeometry, planetMaterial);
        planet.position.x = data.distance; // Initial position
        scene.add(planet);
        planets.push({
          mesh: planet,
          ...data,
          angle: Math.random() * Math.PI * 2 // Random starting angle
        });
      });
    }

    function setupCameraAndControls() {
      camera.position.z = 50; // Initial camera distance
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;      // Enable smooth damping
      controls.dampingFactor = 0.05;     // Damping factor for smooth rotation
    }

    function addPlanetClickHandler() {
      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2();

      window.addEventListener('click', (event) => {
        mouse.set(
          (event.clientX / window.innerWidth) * 2 - 1,
          -(event.clientY / window.innerHeight) * 2 + 1
        );
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(planets.map(p => p.mesh));

        if (intersects.length > 0) { // Check if any planet is intersected
          const clickedObject = intersects[0].object;
          const planet = planets.find(p => p.mesh === clickedObject);

          if (planet) {
            displayPlanetInfo(planet);
          }
        }
      });
    }

    function displayPlanetInfo(planet) {
      const chatMessages = document.getElementById('chat-messages');
      chatMessages.innerHTML += `
        <div class="chat-message system-message">
          🌍 <b>${planet.name}</b><br>
          Size: ${planet.size}x Earth radius<br>
          Orbital Distance: ${planet.distance} AU
        </div>`;
      chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
    }


    // =============================================
    //  Animation Loop
    // =============================================
    function animate() {
      requestAnimationFrame(animate);

      planets.forEach(planet => {
        planet.angle += PLANET_ORBIT_SPEED; // Increment planet angle
        planet.mesh.position.x = Math.cos(planet.angle) * planet.distance;
        planet.mesh.position.z = Math.sin(planet.angle) * planet.distance;
      });

      controls.update(); // Update OrbitControls
      renderer.render(scene, camera);
    }


    // =============================================
    //  AI Chat Functionality (Now Data Fetching from Unity CCD)
    // =============================================
    async function sendChat() {
      const userInput = document.getElementById('user-input').value.trim();
      if (!userInput) return alert('🚀 Please enter a space-related question');

      const chatMessages = document.getElementById('chat-messages');
      const loading = document.getElementById('loading');

      // Add user message
      chatMessages.innerHTML += `<div class="chat-message">👨🚀 <b>You:</b> ${userInput}</div>`;

      loading.style.display = 'block';
      document.getElementById('user-input').value = '';

      try {
        const path2 = `environments/production/buckets/${bucketId_2}/release_by_badge/latest/entry_by_path/content/`;

        // **Example endpoint fetching from the *second* bucket (bucketId_2), assuming you want the content at the root path ("/"):**
        const endpoint = `${baseURL}/${path2}?path=`; // Appending empty path for now, adjust if needed.


        const response = await fetch(endpoint, {
            method: 'GET',
            headers: await getAuthHeader() // Assumes getAuthHeader() function exists
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        const data = await response.json();
        // **Process CCD response here. The following is placeholder:**
        const formattedAnswer = `<pre>Unity CCD Data Response:\n${JSON.stringify(data, null, 2)}</pre>`; // Example formatting
        chatMessages.innerHTML += `
            <div class="chat-message">
                🤖 <b>Data Response:</b> ${formattedAnswer}
            </div>`;


    } catch (error) {
        chatMessages.innerHTML += `
            <div class="chat-message system-message">
                ❌ Error: ${error.message}
            </div>`;
    } finally {
        loading.style.display = 'none';
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}


    async function getAuthHeader() {
      // **IMPORTANT:**  Implement your authentication header retrieval logic here.
      // This is a placeholder. You need to define how to get the auth header
      // required for your backend/service.
      // Example placeholder - replace with your actual auth mechanism:
      console.warn("getAuthHeader() is a placeholder! Implement your authentication logic.");
      return { // **Placeholder - Replace!**
        'Authorization': 'Bearer YOUR_AUTH_TOKEN' // **Replace 'YOUR_AUTH_TOKEN'**
      };
    }


    // =============================================
    //  Event Listeners and Initialization
    // =============================================
    window.onload = initSolarSystem; // Initialize when window loads
  </script>
</body>
</html>
