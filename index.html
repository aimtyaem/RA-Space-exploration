<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solar System 3D + Chat with Labels</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    /* The Three.js canvas will fill the viewport */
    #three-canvas {
      width: 100vw;
      height: 100vh;
      display: block;
      position: relative;
      z-index: 0;
    }
    /* Chat panel on the right */
    #chat-container {
      position: absolute;
      top: 0;
      right: 0;
      width: 300px;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.75);
      color: #fff;
      display: flex;
      flex-direction: column;
      padding: 10px;
      box-sizing: border-box;
      z-index: 10;
    }
    #chat-log {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      border: 1px solid #444;
      padding: 5px;
    }
    #chat-input {
      display: flex;
      gap: 5px;
    }
    #chat-input input {
      flex: 1;
      padding: 5px;
      border: 1px solid #444;
      background-color: #333;
      color: #fff;
    }
    #chat-input button {
      padding: 5px 10px;
      cursor: pointer;
      background-color: #666;
      color: #fff;
      border: 1px solid #444;
    }
    /* Label style for sun and planets */
    .label {
      color: #fff;
      font-size: 16px; /* Increased font size */
      text-shadow: 1px 1px 2px black;
      pointer-events: none;
      white-space: nowrap; /* Prevent text wrapping */
    }
  </style>
</head>
<body>
  <!-- Container for Three.js scene -->
  <div id="three-canvas"></div>
  <!-- Chat panel -->
  <div id="chat-container">
    <div id="chat-log"></div>
    <div id="chat-input">
      <input type="text" id="user-message" placeholder="Ask Gemini..." />
      <button id="send-btn">Send</button>
    </div>
  </div>

  <!-- Three.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r146/three.min.js"></script>
  <!-- OrbitControls -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r146/examples/js/controls/OrbitControls.js"></script>
  <!-- CSS2DRenderer for labels -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r146/examples/js/renderers/CSS2DRenderer.js"></script>
  <script>
    /************************************************************
     * 1) SETUP SCENE, CAMERA, RENDERERS, CONTROLS
     ************************************************************/
    let scene, camera, renderer, controls, labelRenderer;
    const canvasContainer = document.getElementById('three-canvas');

    // Create scene and camera
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(
      60,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    camera.position.set(0, 20, 60);

    // WebGL Renderer for 3D objects
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    canvasContainer.appendChild(renderer.domElement);

    // OrbitControls allow user interaction
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    // CSS2DRenderer for rendering labels (HTML elements in 3D)
    labelRenderer = new THREE.CSS2DRenderer();
    labelRenderer.setSize(window.innerWidth, window.innerHeight);
    labelRenderer.domElement.style.position = 'absolute';
    labelRenderer.domElement.style.top = '0px';
    labelRenderer.domElement.style.left = '0px';
    labelRenderer.domElement.style.pointerEvents = 'none';
    labelRenderer.domElement.style.zIndex = '1'; // Ensure labels are above canvas
    document.body.appendChild(labelRenderer.domElement);

    // Add a point light at the sunâ€™s position
    const pointLight = new THREE.PointLight(0xffffff, 2);
    pointLight.position.set(0, 0, 0);
    scene.add(pointLight);

    /************************************************************
     * 2) CREATE SUN AND PLANETS WITH LABELS
     ************************************************************/
    // Sun setup
    const sunSize = 5;
    const sunGeo = new THREE.SphereGeometry(sunSize, 32, 32);
    const sunMat = new THREE.MeshBasicMaterial({ color: 0xffff00 });
    const sunMesh = new THREE.Mesh(sunGeo, sunMat);
    scene.add(sunMesh);

    // Create a label for the sun
    const sunLabelDiv = document.createElement('div');
    sunLabelDiv.className = 'label';
    sunLabelDiv.textContent = 'Sun';
    const sunLabel = new THREE.CSS2DObject(sunLabelDiv);
    sunLabel.position.set(0, sunSize + 1, 0);
    sunMesh.add(sunLabel);

    // Data for planets (name, color, size, orbit distance, and orbit speed)
    const planetData = [
      { name: 'Mercury', color: 0xcccccc, size: 0.6, distance: 10, speed: 50 },
      { name: 'Venus',   color: 0xffd700, size: 1.0, distance: 14, speed: 30 },
      { name: 'Earth',   color: 0x0000ff, size: 1.2, distance: 20, speed: 20 },
      { name: 'Mars',    color: 0xff3333, size: 0.9, distance: 26, speed: 17 },
      { name: 'Jupiter', color: 0xffa500, size: 2.0, distance: 35, speed: 10 },
      { name: 'Saturn',  color: 0xffcc66, size: 1.8, distance: 45, speed: 8 },
      { name: 'Uranus',  color: 0x66ffff, size: 1.5, distance: 55, speed: 6 },
      { name: 'Neptune', color: 0x3333ff, size: 1.5, distance: 65, speed: 5 },
    ];

    // Create planet meshes and attach labels
    const planets = [];
    planetData.forEach((p) => {
      const geo = new THREE.SphereGeometry(p.size, 32, 32);
      const mat = new THREE.MeshPhongMaterial({ color: p.color });
      const mesh = new THREE.Mesh(geo, mat);
      // Initially position planet along the +X axis
      mesh.position.set(p.distance, 0, 0);
      scene.add(mesh);

      // Create and attach a label for the planet
      const labelDiv = document.createElement('div');
      labelDiv.className = 'label';
      labelDiv.textContent = p.name;
      const label = new THREE.CSS2DObject(labelDiv);
      label.position.set(0, p.size + 0.5, 0);
      mesh.add(label);

      planets.push({
        name: p.name,
        mesh: mesh,
        distance: p.distance,
        speed: p.speed, // Orbit speed in degrees per second
        size: p.size
      });
    });

    /************************************************************
     * 3) ORBIT LOGIC (ROTATE AROUND THE SUN)
     ************************************************************/
    // Rotate a planet around the Y-axis (like Unity's RotateAround)
    function rotateAroundY(planetMesh, center, degreesPerSecond, deltaTime) {
      const angle = (degreesPerSecond * deltaTime) * (Math.PI / 180);
      // Calculate position relative to center
      const pos = new THREE.Vector3().subVectors(planetMesh.position, center);
      const cosA = Math.cos(angle);
      const sinA = Math.sin(angle);
      const x = pos.x * cosA - pos.z * sinA;
      const z = pos.x * sinA + pos.z * cosA;
      pos.x = x;
      pos.z = z;
      // Update planet position (relative to center)
      planetMesh.position.copy(pos.add(center));
    }

    /************************************************************
     * 4) ANIMATION LOOP
     ************************************************************/
    let lastTime = 0;
    function animate(time) {
      requestAnimationFrame(animate);
      const deltaTime = (time - lastTime) / 1000;
      lastTime = time;

      // Rotate each planet around the sun
      planets.forEach(p => {
        rotateAroundY(p.mesh, sunMesh.position, p.speed, deltaTime);
      });

      controls.update();
      renderer.render(scene, camera);
      labelRenderer.render(scene, camera);
    }
    requestAnimationFrame(animate);

    // Handle window resize
    window.addEventListener('resize', onWindowResize, false);
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      labelRenderer.setSize(window.innerWidth, window.innerHeight);
    }

    /************************************************************
     * 5) GEMINI-STYLE CHATBOT (SIMPLE PLACEHOLDER)
     ************************************************************/
    const chatLog = document.getElementById('chat-log');
    const userInput = document.getElementById('user-message');
    const sendBtn = document.getElementById('send-btn');

    function addChatMessage(msg, sender = 'user') {
      const div = document.createElement('div');
      div.style.margin = '5px 0';
      if (sender === 'user') {
        div.innerHTML = `<strong>You:</strong> ${msg}`;
      } else if (sender === 'gemini') {
        div.innerHTML = `<strong>Gemini:</strong> ${msg}`;
      } else if (sender === 'system') {
        div.innerHTML = `<em>${msg}</em>`;
      }
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    // Placeholder Gemini response (replace with your API if needed)
    function geminiRespond(userText) {
      return `I am Gemini. You said: "${userText}". How can I assist further?`;
    }

    sendBtn.addEventListener('click', () => {
      const text = userInput.value.trim();
      if (text === '') return;
      addChatMessage(text, 'user');
      userInput.value = '';
      const response = geminiRespond(text);
      addChatMessage(response, 'gemini');
    });
  </script>
</body>
</html>